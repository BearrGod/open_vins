<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>System Evaluation &raquo; Filter Timing Analysis | OpenVINS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600&amp;subset=latin-ext" />
  <link rel="stylesheet" href="m-udel+documentation.compiled.css" />
  <link rel="stylesheet" href="custom.css" />
  <link rel="icon" href="favicon-light.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2f73a3" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OpenVINS</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="namespaceov__core.html">ov_core</a></li>
            <li><a href="namespaceov__type.html">ov_type</a></li>
            <li><a href="namespaceov__msckf.html">ov_msckf</a></li>
            <li><a href="namespaceov__init.html">ov_init</a></li>
            <li><a href="namespaceov__eval.html">ov_eval</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="8">
            <li><a href="https://github.com/rpng/open_vins/">GitHub</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="evaluation.html">System Evaluation</a> &raquo;</span>
          Filter Timing Analysis
        </h1>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#eval-ov-timing-collection">Collection</a></li>
            <li>
              <a href="#eval-ov-timing-plot">Processing &amp; Plotting</a>
              <ul>
                <li><a href="#eval-ov-timing-flame">Script &quot;timing_flamegraph&quot;</a></li>
                <li><a href="#eval-ov-timing-hist">Script &quot;timing_histogram&quot;</a></li>
                <li><a href="#eval-ov-timing-compare">Script &quot;timing_comparison&quot;</a></li>
                <li><a href="#eval-ov-timing-percentages">Script &quot;timing_percentages&quot;</a></li>
              </ul>
            </li>
          </ul>
        </div>
<aside class="m-note m-warning"><h3>Installation Warning</h3><p>If you plan to use the included plotting from the cpp code, you will need to make sure that you have matplotlib and python 2.7 installed. We use the to <a href="https://github.com/lava/matplotlib-cpp">matplotlib-cpp</a> to call this external library and generate the desired figures. Please see <a href="gs-installing.html#gs-install-oveval" class="m-doc">Additional Evaluation Requirements</a> for more details on the exact install.</p></aside><section id="eval-ov-timing-collection"><h2><a href="#eval-ov-timing-collection">Collection</a></h2><p>To profile the different parts of the system we record the timing information from directly inside the <a href="classov__msckf_1_1VioManager.html" class="m-doc">ov_msckf::<wbr />VioManager</a>. The file should be comma separated format, with the first column being the timing, and the last column being the total time (units are all in seconds). The middle columns should describe how much each component takes (whose names are extracted from the header of the csv file). You can use the bellow tools as long as you follow this format, and add or remove components as you see fit to the middle columns.</p><p>To evaluate the computational load (<em>not computation time</em>), we have a python script that leverages the <a href="https://github.com/giampaolo/psutil">psutil</a> python package to record percent CPU and memory consumption. This can be included as an additional node in the launch file which only needs the node which you want the reported information of. This will poll the node for its percent memory, percent cpu, and total number of threads that it uses. This can be useful if you wish to compare different methods on the same platform, but doesn&#x27;t make sense to use this to compare the running of the same algorithm or different algorithms <em>across</em> different hardware devices.</p><pre class="m-code"><span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recorder_timing&quot;</span> <span class="na">pkg=</span><span class="s">&quot;ov_eval&quot;</span> <span class="na">type=</span><span class="s">&quot;pid_ros.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;nodes&quot;</span>   <span class="na">type=</span><span class="s">&quot;str&quot;</span> <span class="na">value=</span><span class="s">&quot;/run_subscribe_msckf&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span>  <span class="na">type=</span><span class="s">&quot;str&quot;</span> <span class="na">value=</span><span class="s">&quot;/tmp/psutil_log.txt&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/node&gt;</span></pre><p>It is also important to note that if the estimator has multiple nodes, you can subscribe to them all by specifying their names as a comma separated string. For example to evaluate the computation needed for <a href="https://github.com/HKUST-Aerial-Robotics/VINS-Mono/blob/master/vins_estimator/launch/euroc.launch">VINS-Mono</a> multi-node system we can do:</p><pre class="m-code"><span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recorder_timing&quot;</span> <span class="na">pkg=</span><span class="s">&quot;ov_eval&quot;</span> <span class="na">type=</span><span class="s">&quot;pid_ros.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;nodes&quot;</span>   <span class="na">type=</span><span class="s">&quot;str&quot;</span> <span class="na">value=</span><span class="s">&quot;/feature_tracker,/vins_estimator,/pose_graph&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;output&quot;</span>  <span class="na">type=</span><span class="s">&quot;str&quot;</span> <span class="na">value=</span><span class="s">&quot;/tmp/psutil_log.txt&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/node&gt;</span></pre></section><section id="eval-ov-timing-plot"><h2><a href="#eval-ov-timing-plot">Processing &amp; Plotting</a></h2><section id="eval-ov-timing-flame"><h3><a href="#eval-ov-timing-flame">Script &quot;timing_flamegraph&quot;</a></h3><p>The flame graph script looks to recreate a <a href="https://github.com/brendangregg/FlameGraph">FlameGraph</a> of the key components of the system. While we do not trace all functions, the key &quot;top level&quot; function times are recorded to file to allow for insight into what is taking the majority of the computation. The file should be comma separated format, with the first column being the timing, and the last column being the total time. The middle columns should describe how much each component takes (whose names are extracted from the header of the csv file).</p><pre class="m-console"><span class="go">rosrun ov_eval timing_flamegraph &lt;file_times.txt&gt;</span>
<span class="go">rosrun ov_eval timing_flamegraph timing_mono_ethV101.txt</span></pre><p>Example output:</p><pre class="m-console"><span class="go">[TIME]: loaded 2817 timestamps from file (7 categories)!!</span>
<span class="go">mean_time = 0.0037 | std = 0.0011 | 99th = 0.0063  | max = 0.0254 (tracking)</span>
<span class="go">mean_time = 0.0004 | std = 0.0001 | 99th = 0.0006  | max = 0.0014 ( propagation)</span>
<span class="go">mean_time = 0.0032 | std = 0.0022 | 99th = 0.0083  | max = 0.0309 (msckf update)</span>
<span class="go">mean_time = 0.0034 | std = 0.0013 | 99th = 0.0063  | max = 0.0099 (slam update)</span>
<span class="go">mean_time = 0.0012 | std = 0.0017 | 99th = 0.0052  | max = 0.0141 (slam delayed)</span>
<span class="go">mean_time = 0.0009 | std = 0.0003 | 99th = 0.0015  | max = 0.0027 (marginalization)</span>
<span class="go">mean_time = 0.0128 | std = 0.0035 | 99th = 0.0208  | max = 0.0403 (total)</span></pre><img class="m-image" src="timing_flame.png" alt="Image" style="width: 90%;" /></section><section id="eval-ov-timing-hist"><h3><a href="#eval-ov-timing-hist">Script &quot;timing_histogram&quot;</a></h3><p>Generates a histogram plot of <em>binned</em> execution times for a specific class. This allows for inspection of the distribution of times as compared to just the mean of it. The file should be comma separated format, with the first column being the timing, and the last column being the total time. The middle columns should describe how much each component takes (whose names are extracted from the header of the csv file).</p><pre class="m-console"><span class="go">rosrun ov_eval timing_histogram &lt;file_times.txt&gt; &lt;num_bins&gt;</span>
<span class="go">rosrun ov_eval timing_histogram timing_mono_ethV101.txt 75</span></pre><img class="m-image" src="timing_hist.png" alt="Image" style="width: 90%;" /></section><section id="eval-ov-timing-compare"><h3><a href="#eval-ov-timing-compare">Script &quot;timing_comparison&quot;</a></h3><p>This script is use to compare the run-time of different runs of the algorithm. This take in the same file as the flame graph and is recorded in the <a href="classov__msckf_1_1VioManager.html" class="m-doc">ov_msckf::<wbr />VioManager</a>. The file should be comma separated format, with the first column being the timing, and the last column being the total time. The middle columns should describe how much each component takes (whose names are extracted from the header of the csv file).</p><pre class="m-console"><span class="go">rosrun ov_eval timing_comparison &lt;file_times1.txt&gt; ... &lt;file_timesN.txt&gt;</span>
<span class="go">rosrun ov_eval timing_comparison timing_mono_ethV101.txt timing_stereo_ethV101.txt</span></pre><p>Example output:</p><pre class="m-console"><span class="go">======================================</span>
<span class="go">[TIME]: loading data for timing_mono</span>
<span class="go">[TIME]: loaded 2817 timestamps from file (7 categories)!!</span>
<span class="go">mean_time = 0.0037 | std = 0.0011 | 99th = 0.0063  | max = 0.0254 (tracking)</span>
<span class="go">mean_time = 0.0004 | std = 0.0001 | 99th = 0.0006  | max = 0.0014 (propagation)</span>
<span class="go">mean_time = 0.0032 | std = 0.0022 | 99th = 0.0083  | max = 0.0309 (msckf update)</span>
<span class="go">mean_time = 0.0034 | std = 0.0013 | 99th = 0.0063  | max = 0.0099 (slam update)</span>
<span class="go">mean_time = 0.0012 | std = 0.0017 | 99th = 0.0052  | max = 0.0141 (slam delayed)</span>
<span class="go">mean_time = 0.0009 | std = 0.0003 | 99th = 0.0015  | max = 0.0027 (marginalization)</span>
<span class="go">mean_time = 0.0128 | std = 0.0035 | 99th = 0.0208  | max = 0.0403 (total)</span>
<span class="go">======================================</span>
<span class="go">======================================</span>
<span class="go">[TIME]: loading data for timing_stereo</span>
<span class="go">[TIME]: loaded 2817 timestamps from file (7 categories)!!</span>
<span class="go">mean_time = 0.0077 | std = 0.0020 | 99th = 0.0124  | max = 0.0219 (tracking)</span>
<span class="go">mean_time = 0.0004 | std = 0.0001 | 99th = 0.0007  | max = 0.0023 (propagation)</span>
<span class="go">mean_time = 0.0081 | std = 0.0047 | 99th = 0.0189  | max = 0.0900 (msckf update)</span>
<span class="go">mean_time = 0.0063 | std = 0.0023 | 99th = 0.0117  | max = 0.0151 (slam update)</span>
<span class="go">mean_time = 0.0020 | std = 0.0026 | 99th = 0.0079  | max = 0.0205 (slam delayed)</span>
<span class="go">mean_time = 0.0019 | std = 0.0005 | 99th = 0.0031  | max = 0.0052 (marginalization)</span>
<span class="go">mean_time = 0.0263 | std = 0.0063 | 99th = 0.0410  | max = 0.0979 (total)</span>
<span class="go">======================================</span></pre><img class="m-image" src="timing_compare.png" alt="Image" style="width: 90%;" /></section><section id="eval-ov-timing-percentages"><h3><a href="#eval-ov-timing-percentages">Script &quot;timing_percentages&quot;</a></h3><p>This utility allows for comparing the resources used by the algorithm on a specific platform. An example usage would be how the memory and cpu requirements increase as the state size grows or as more cameras are added. You will need to record the format using the <code>pid_ros.py</code> node (see <a href="eval-timing.html#eval-ov-timing-collection" class="m-doc">Collection</a> for details on how to use it). Remember that 100% cpu usage means that it takes one cpu thread to support the system, while 200% means it takes two cpu threads to support the system (see <a href="https://superuser.com/a/457634/707974">this link</a> for an explanation). The folder structure needed is as follows:</p><pre class="m-code">psutil_logs/
    ov_mono/
        run1<span class="p">.</span>txt
        run2<span class="p">.</span>txt
        run3<span class="p">.</span>txt
    ov_stereo/
        run1<span class="p">.</span>txt
        run2<span class="p">.</span>txt
        run3<span class="p">.</span>txt</pre><pre class="m-console"><span class="go">rosrun ov_eval timing_percentages &lt;timings_folder&gt;</span>
<span class="go">rosrun ov_eval timing_percentages psutil_logs/</span></pre><p>Example output:</p><pre class="m-console"><span class="go">======================================</span>
<span class="go">[COMP]: processing ov_mono algorithm</span>
<span class="go">    loaded 149 timestamps from file!!</span>
<span class="go">    PREC: mean_cpu = 83.858 +- 17.130</span>
<span class="go">    PREC: mean_mem = 0.266 +- 0.019</span>
<span class="go">    THR: mean_threads = 12.893 +- 0.924</span>
<span class="go">======================================</span>
<span class="go">======================================</span>
<span class="go">[COMP]: processing ov_stereo algorithm</span>
<span class="go">    loaded 148 timestamps from file!!</span>
<span class="go">    PREC: mean_cpu = 111.007 +- 16.519</span>
<span class="go">    PREC: mean_mem = 5.139 +- 2.889</span>
<span class="go">    THR: mean_threads = 12.905 +- 0.943</span>
<span class="go">======================================</span></pre><img class="m-image" src="timing_percent.png" alt="Image" style="width: 90%;" /></section></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
