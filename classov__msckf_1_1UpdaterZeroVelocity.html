<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ov_msckf::UpdaterZeroVelocity class | OpenVINS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600&amp;subset=latin-ext" />
  <link rel="stylesheet" href="m-udel+documentation.compiled.css" />
  <link rel="stylesheet" href="custom.css" />
  <link rel="icon" href="favicon-light.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2f73a3" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OpenVINS</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="namespaceov__core.html">ov_core</a></li>
            <li><a href="namespaceov__type.html">ov_type</a></li>
            <li><a href="namespaceov__msckf.html">ov_msckf</a></li>
            <li><a href="namespaceov__init.html">ov_init</a></li>
            <li><a href="namespaceov__eval.html">ov_eval</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="8">
            <li><a href="https://github.com/rpng/open_vins/">GitHub</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="namespaceov__msckf.html">ov_msckf</a>::<wbr/></span>UpdaterZeroVelocity <span class="m-thin">class</span>
        </h1>
        <p>Will try to <em>detect</em> and then update using zero velocity assumption.</p>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#typeless-methods">Constructors, destructors, conversion operators</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
                <li><a href="#pro-attribs">Protected variables</a></li>
              </ul>
            </li>
          </ul>
        </div>
<p>Consider the case that a VIO unit remains stationary for a period time. Typically this can cause issues in a monocular system without SLAM features since no features can be triangulated. Additional, if features could be triangulated (e.g. stereo) the quality can be poor and hurt performance. If we can detect the cases where we are stationary then we can leverage this to prevent the need to do feature update during this period. The main application would be using this on a <strong>wheeled vehicle</strong> which needs to stop (e.g. stop lights or parking).</p>
        <section id="typeless-methods">
          <h2><a href="#typeless-methods">Constructors, destructors, conversion operators</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper"><a href="#a1077d2767c078874ed48132ebaa9b975" class="m-doc">UpdaterZeroVelocity</a>(</span><span class="m-doc-wrap"><a href="structov__msckf_1_1UpdaterOptions.html" class="m-doc">UpdaterOptions</a>&amp; options,
              <a href="structov__msckf_1_1NoiseManager.html" class="m-doc">NoiseManager</a>&amp; noises,
              std::shared_ptr&lt;<a href="classov__core_1_1FeatureDatabase.html" class="m-doc">ov_core::<wbr />FeatureDatabase</a>&gt; db,
              std::shared_ptr&lt;<a href="classov__msckf_1_1Propagator.html" class="m-doc">Propagator</a>&gt; prop,
              double gravity_mag,
              double zupt_max_velocity,
              double zupt_noise_multiplier,
              double zupt_max_disparity)</span>
            </dt>
            <dd>Default constructor for our zero velocity detector and updater.</dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a85e0ca4c3728853d6e12ae4ec9bf691d" class="m-doc">feed_imu</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1ImuData.html" class="m-doc">ov_core::<wbr />ImuData</a>&amp; message,
              double oldest_time = -1)</span>
            </dt>
            <dd>Feed function for inertial data.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a7e5af15b3766f85ec3aa29fdac3a696e" class="m-doc">clean_old_imu_measurements</a>(</span><span class="m-doc-wrap">double oldest_time)</span>
            </dt>
            <dd>This will remove any IMU measurements that are older then the given measurement time.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a703a198829da68f905280ce8af8aa9e6" class="m-doc">try_update</a>(</span><span class="m-doc-wrap">std::shared_ptr&lt;<a href="classov__msckf_1_1State.html" class="m-doc">State</a>&gt; state,
              double timestamp) -&gt; bool</span>
            </dt>
            <dd>Will first detect if the system is zero velocity, then will update.</dd>
          </dl>
        </section>
        <section id="pro-attribs">
          <h2><a href="#pro-attribs">Protected variables</a></h2>
          <dl class="m-doc">
            <dt id="a749638ff6ee8f1b0ba8eee2bef7e93e8">
              <a href="structov__msckf_1_1UpdaterOptions.html" class="m-doc">UpdaterOptions</a> <a href="#a749638ff6ee8f1b0ba8eee2bef7e93e8" class="m-doc-self">_options</a>
            </dt>
            <dd>Options used during update (chi2 multiplier)</dd>
            <dt id="a40b315489e839b9f47168b13ff3ea625">
              <a href="structov__msckf_1_1NoiseManager.html" class="m-doc">NoiseManager</a> <a href="#a40b315489e839b9f47168b13ff3ea625" class="m-doc-self">_noises</a>
            </dt>
            <dd>Container for the imu noise values.</dd>
            <dt id="a8faef43ba67821767973ee9a78c173cc">
              std::shared_ptr&lt;<a href="classov__core_1_1FeatureDatabase.html" class="m-doc">ov_core::<wbr />FeatureDatabase</a>&gt; <a href="#a8faef43ba67821767973ee9a78c173cc" class="m-doc-self">_db</a>
            </dt>
            <dd>Feature tracker database with all features in it.</dd>
            <dt id="aff9a0009bd455014af4dea494fcb2b33">
              std::shared_ptr&lt;<a href="classov__msckf_1_1Propagator.html" class="m-doc">Propagator</a>&gt; <a href="#aff9a0009bd455014af4dea494fcb2b33" class="m-doc-self">_prop</a>
            </dt>
            <dd>Our propagator!</dd>
            <dt id="aa0bd3b68624d85a6e9db27a1d1631486">
              Eigen::Vector3d <a href="#aa0bd3b68624d85a6e9db27a1d1631486" class="m-doc-self">_gravity</a>
            </dt>
            <dd>Gravity vector.</dd>
            <dt id="a27800e861318dfd8938005dc8b7507cf">
              double <a href="#a27800e861318dfd8938005dc8b7507cf" class="m-doc-self">_zupt_max_velocity</a>
            </dt>
            <dd>Max velocity (m/s) that we should consider a zupt with.</dd>
            <dt id="a4cb7aba647c32c927075fbffd7573b5e">
              double <a href="#a4cb7aba647c32c927075fbffd7573b5e" class="m-doc-self">_zupt_noise_multiplier</a>
            </dt>
            <dd>Multiplier of our IMU noise matrix (default should be 1.0)</dd>
            <dt id="a2ef8c37273e0159bd83cc34cccce1099">
              double <a href="#a2ef8c37273e0159bd83cc34cccce1099" class="m-doc-self">_zupt_max_disparity</a>
            </dt>
            <dd>Max disparity (pixels) that we should consider a zupt with.</dd>
            <dt id="a5b6c97d5985ae971821aaeaed715e717">
              std::map&lt;int, double&gt; <a href="#a5b6c97d5985ae971821aaeaed715e717" class="m-doc-self">chi_squared_table</a>
            </dt>
            <dd>Chi squared 95th percentile table (lookup would be size of residual)</dd>
            <dt id="a38119874bfd080afe2f21444e7f26692">
              std::vector&lt;<a href="structov__core_1_1ImuData.html" class="m-doc">ov_core::<wbr />ImuData</a>&gt; <a href="#a38119874bfd080afe2f21444e7f26692" class="m-doc-self">imu_data</a>
            </dt>
            <dd>Our history of IMU messages (time, angular, linear)</dd>
            <dt id="ae3d40558eff57d631724a15ab431f83a">
              double <a href="#ae3d40558eff57d631724a15ab431f83a" class="m-doc-self">last_prop_time_offset</a>
            </dt>
            <dd>Estimate for time offset at last propagation time.</dd>
            <dt id="a6b782fc825eddcd71a7808288cbb9734">
              double <a href="#a6b782fc825eddcd71a7808288cbb9734" class="m-doc-self">last_zupt_state_timestamp</a>
            </dt>
            <dd>Last timestamp we did zero velocity update with.</dd>
            <dt id="a3358cda7ba4b450b49f3e1594d974732">
              int <a href="#a3358cda7ba4b450b49f3e1594d974732" class="m-doc-self">last_zupt_count</a>
            </dt>
            <dd>Number of times we have called update.</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="a1077d2767c078874ed48132ebaa9b975"><div>
            <h3>
              <span class="m-doc-wrap-bumper"> ov_msckf::<wbr />UpdaterZeroVelocity::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a1077d2767c078874ed48132ebaa9b975" class="m-doc-self">UpdaterZeroVelocity</a>(</span><span class="m-doc-wrap"><a href="structov__msckf_1_1UpdaterOptions.html" class="m-doc">UpdaterOptions</a>&amp; options,
              <a href="structov__msckf_1_1NoiseManager.html" class="m-doc">NoiseManager</a>&amp; noises,
              std::shared_ptr&lt;<a href="classov__core_1_1FeatureDatabase.html" class="m-doc">ov_core::<wbr />FeatureDatabase</a>&gt; db,
              std::shared_ptr&lt;<a href="classov__msckf_1_1Propagator.html" class="m-doc">Propagator</a>&gt; prop,
              double gravity_mag,
              double zupt_max_velocity,
              double zupt_noise_multiplier,
              double zupt_max_disparity)</span></span>
            </h3>
            <p>Default constructor for our zero velocity detector and updater.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">options</td>
                  <td>Updater options (chi2 multiplier)</td>
                </tr>
                <tr>
                  <td>noises</td>
                  <td>imu noise characteristics (continuous time)</td>
                </tr>
                <tr>
                  <td>db</td>
                  <td>Feature tracker database with all features in it</td>
                </tr>
                <tr>
                  <td>prop</td>
                  <td><a href="classov__msckf_1_1Propagator.html" class="m-doc">Propagator</a> class object which can predict the state forward in time</td>
                </tr>
                <tr>
                  <td>gravity_mag</td>
                  <td>Global gravity magnitude of the system (normally 9.81)</td>
                </tr>
                <tr>
                  <td>zupt_max_velocity</td>
                  <td>Max velocity we should consider to do a update with</td>
                </tr>
                <tr>
                  <td>zupt_noise_multiplier</td>
                  <td>Multiplier of our IMU noise matrix (default should be 1.0)</td>
                </tr>
                <tr>
                  <td>zupt_max_disparity</td>
                  <td>Max disparity we should consider to do a update with</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a85e0ca4c3728853d6e12ae4ec9bf691d"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_msckf::<wbr />UpdaterZeroVelocity::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a85e0ca4c3728853d6e12ae4ec9bf691d" class="m-doc-self">feed_imu</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1ImuData.html" class="m-doc">ov_core::<wbr />ImuData</a>&amp; message,
              double oldest_time = -1)</span></span>
            </h3>
            <p>Feed function for inertial data.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">message</td>
                  <td>Contains our timestamp and inertial information</td>
                </tr>
                <tr>
                  <td>oldest_time</td>
                  <td>Time that we can discard measurements before</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a7e5af15b3766f85ec3aa29fdac3a696e"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_msckf::<wbr />UpdaterZeroVelocity::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a7e5af15b3766f85ec3aa29fdac3a696e" class="m-doc-self">clean_old_imu_measurements</a>(</span><span class="m-doc-wrap">double oldest_time)</span></span>
            </h3>
            <p>This will remove any IMU measurements that are older then the given measurement time.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">oldest_time</td>
                  <td>Time that we can discard measurements before (in IMU clock)</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a703a198829da68f905280ce8af8aa9e6"><div>
            <h3>
              <span class="m-doc-wrap-bumper">bool ov_msckf::<wbr />UpdaterZeroVelocity::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a703a198829da68f905280ce8af8aa9e6" class="m-doc-self">try_update</a>(</span><span class="m-doc-wrap">std::shared_ptr&lt;<a href="classov__msckf_1_1State.html" class="m-doc">State</a>&gt; state,
              double timestamp)</span></span>
            </h3>
            <p>Will first detect if the system is zero velocity, then will update.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">state</td>
                  <td><a href="classov__msckf_1_1State.html" class="m-doc">State</a> of the filter</td>
                </tr>
                <tr>
                  <td>timestamp</td>
                  <td>Next camera timestamp we want to see if we should propagate to.</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <th>Returns</th>
                  <td>True if the system is currently at zero velocity</td>
                </tr>
              </tfoot>
            </table>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
