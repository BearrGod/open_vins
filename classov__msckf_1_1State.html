<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ov_msckf::State class | OpenVINS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600&amp;subset=latin-ext" />
  <link rel="stylesheet" href="m-udel+documentation.compiled.css" />
  <link rel="stylesheet" href="custom.css" />
  <link rel="icon" href="favicon-light.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2f73a3" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OpenVINS</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="namespaceov__core.html">ov_core</a></li>
            <li><a href="namespaceov__type.html">ov_type</a></li>
            <li><a href="namespaceov__msckf.html">ov_msckf</a></li>
            <li><a href="namespaceov__init.html">ov_init</a></li>
            <li><a href="namespaceov__eval.html">ov_eval</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="8">
            <li><a href="https://github.com/rpng/open_vins/">GitHub</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="namespaceov__msckf.html">ov_msckf</a>::<wbr/></span>State <span class="m-thin">class</span>
        </h1>
        <p><a href="classov__msckf_1_1State.html" class="m-doc">State</a> of our filter.</p>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#pub-static-methods">Public static functions</a></li>
                <li><a href="#typeless-methods">Constructors, destructors, conversion operators</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
                <li><a href="#pub-attribs">Public variables</a></li>
              </ul>
            </li>
          </ul>
        </div>
<p>This state has all the current estimates for the filter. This system is modeled after the MSCKF filter, thus we have a sliding window of clones. We additionally have more parameters for online estimation of calibration and SLAM features. We also have the covariance of the system, which should be managed using the <a href="classov__msckf_1_1StateHelper.html" class="m-doc">StateHelper</a> class.</p>
        <section id="pub-static-methods">
          <h2><a href="#pub-static-methods">Public static functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">static auto <a href="#a3a8f85e6481f2418288b7692d9eaa6a0" class="m-doc">Dm</a>(</span><span class="m-doc-wrap"><a href="structov__msckf_1_1StateOptions.html#a4e021a0c4752fd6990fffb60f775dbb7" class="m-doc">StateOptions::<wbr />ImuModel</a> imu_model,
              const Eigen::MatrixXd&amp; vec) -&gt; Eigen::Matrix3d</span>
            </dt>
            <dd>Gyroscope and accelerometer intrinsic matrix (scale imperfection and axis misalignment)</dd>
            <dt>
              <span class="m-doc-wrap-bumper">static auto <a href="#ae8e70766eaaf8d4009a2c0f519bb645e" class="m-doc">Tg</a>(</span><span class="m-doc-wrap">const Eigen::MatrixXd&amp; vec) -&gt; Eigen::Matrix3d</span>
            </dt>
            <dd>Gyroscope gravity sensitivity.</dd>
          </dl>
        </section>
        <section id="typeless-methods">
          <h2><a href="#typeless-methods">Constructors, destructors, conversion operators</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper"><a href="#ad6098accfeb57e7eb8c8a22bfd45ec0b" class="m-doc">State</a>(</span><span class="m-doc-wrap"><a href="structov__msckf_1_1StateOptions.html" class="m-doc">StateOptions</a>&amp; options_)</span>
            </dt>
            <dd>Default Constructor (will initialize variables to defaults)</dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a36420e71ffa54625667eac2a8a345582" class="m-doc">margtimestep</a>(</span><span class="m-doc-wrap">) -&gt; double</span>
            </dt>
            <dd>Will return the timestep that we will marginalize next. As of right now, since we are using a sliding window, this is the oldest clone. But if you wanted to do a keyframe system, you could selectively marginalize clones.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a37c45cc1d3d1a3dcc46d3799a997355f" class="m-doc">max_covariance_size</a>(</span><span class="m-doc-wrap">) -&gt; int</span>
            </dt>
            <dd>Calculates the current max size of the covariance.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#ad9274f5ef5012b4108666c7d0e461934" class="m-doc">imu_intrinsic_size</a>(</span><span class="m-doc-wrap">) const -&gt; int</span>
            </dt>
            <dd>Calculates the error state size for imu intrinsics.</dd>
          </dl>
        </section>
        <section id="pub-attribs">
          <h2><a href="#pub-attribs">Public variables</a></h2>
          <dl class="m-doc">
            <dt id="aeeb7b0285a968cf364335db8985aacb9">
              std::mutex <a href="#aeeb7b0285a968cf364335db8985aacb9" class="m-doc-self">_mutex_state</a>
            </dt>
            <dd>Mutex for locking access to the state.</dd>
            <dt id="ae7615177e3edeb8eac39eb05867dc72f">
              double <a href="#ae7615177e3edeb8eac39eb05867dc72f" class="m-doc-self">_timestamp</a>
            </dt>
            <dd>Current timestamp (should be the last update time in camera clock frame!)</dd>
            <dt id="a2af409a71537d305b45c62a91b6dda75">
              <a href="structov__msckf_1_1StateOptions.html" class="m-doc">StateOptions</a> <a href="#a2af409a71537d305b45c62a91b6dda75" class="m-doc-self">_options</a>
            </dt>
            <dd>Struct containing filter options.</dd>
            <dt id="aeb5600395921fb8ac81f585006186a64">
              std::shared_ptr&lt;<a href="classov__type_1_1IMU.html" class="m-doc">ov_type::<wbr />IMU</a>&gt; <a href="#aeb5600395921fb8ac81f585006186a64" class="m-doc-self">_imu</a>
            </dt>
            <dd>Pointer to the &quot;active&quot; IMU state (q_GtoI, p_IinG, v_IinG, bg, ba)</dd>
            <dt id="a9fdd8bcc9f67c124257a8daa81bfb15d">
              std::map&lt;double, std::shared_ptr&lt;<a href="classov__type_1_1PoseJPL.html" class="m-doc">ov_type::<wbr />PoseJPL</a>&gt;&gt; <a href="#a9fdd8bcc9f67c124257a8daa81bfb15d" class="m-doc-self">_clones_IMU</a>
            </dt>
            <dd>Map between imaging times and clone poses (q_GtoIi, p_IiinG)</dd>
            <dt id="ac08dc6bd1557fd4c3639d5eb2a998cb4">
              std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__type_1_1Landmark.html" class="m-doc">ov_type::<wbr />Landmark</a>&gt;&gt; <a href="#ac08dc6bd1557fd4c3639d5eb2a998cb4" class="m-doc-self">_features_SLAM</a>
            </dt>
            <dd>Our current set of SLAM features (3d positions)</dd>
            <dt id="a0ef68be4e06e4b4947c86852d1005893">
              std::shared_ptr&lt;<a href="classov__type_1_1Vec.html" class="m-doc">ov_type::<wbr />Vec</a>&gt; <a href="#a0ef68be4e06e4b4947c86852d1005893" class="m-doc-self">_calib_dt_CAMtoIMU</a>
            </dt>
            <dd>Time offset base IMU to camera (t_imu = t_cam + t_off)</dd>
            <dt id="a61797fa8310111f413c5c5b45c19460b">
              std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__type_1_1PoseJPL.html" class="m-doc">ov_type::<wbr />PoseJPL</a>&gt;&gt; <a href="#a61797fa8310111f413c5c5b45c19460b" class="m-doc-self">_calib_IMUtoCAM</a>
            </dt>
            <dd>Calibration poses for each camera (R_ItoC, p_IinC)</dd>
            <dt id="a5323d1f31a15c9b54b6696ffb5db353f">
              std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__type_1_1Vec.html" class="m-doc">ov_type::<wbr />Vec</a>&gt;&gt; <a href="#a5323d1f31a15c9b54b6696ffb5db353f" class="m-doc-self">_cam_intrinsics</a>
            </dt>
            <dd>Camera intrinsics.</dd>
            <dt id="af66308da3cab5bcc0098aadd5a16e874">
              std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__core_1_1CamBase.html" class="m-doc">ov_core::<wbr />CamBase</a>&gt;&gt; <a href="#af66308da3cab5bcc0098aadd5a16e874" class="m-doc-self">_cam_intrinsics_cameras</a>
            </dt>
            <dd>Camera intrinsics camera objects.</dd>
            <dt id="a1eaae4a7476bd6335f9474fcd5184200">
              std::shared_ptr&lt;<a href="classov__type_1_1Vec.html" class="m-doc">ov_type::<wbr />Vec</a>&gt; <a href="#a1eaae4a7476bd6335f9474fcd5184200" class="m-doc-self">_calib_imu_dw</a>
            </dt>
            <dd>Gyroscope IMU intrinsics (scale imperfection and axis misalignment)</dd>
            <dt id="aec156dc6e477759b25aef13689110a93">
              std::shared_ptr&lt;<a href="classov__type_1_1Vec.html" class="m-doc">ov_type::<wbr />Vec</a>&gt; <a href="#aec156dc6e477759b25aef13689110a93" class="m-doc-self">_calib_imu_da</a>
            </dt>
            <dd>Accelerometer IMU intrinsics (scale imperfection and axis misalignment)</dd>
            <dt id="af2affc81c7ec40b81249a98384025b6d">
              std::shared_ptr&lt;<a href="classov__type_1_1Vec.html" class="m-doc">ov_type::<wbr />Vec</a>&gt; <a href="#af2affc81c7ec40b81249a98384025b6d" class="m-doc-self">_calib_imu_tg</a>
            </dt>
            <dd>Gyroscope gravity sensitivity.</dd>
            <dt id="aa7f71683c999ad0c08701277fd6dd733">
              std::shared_ptr&lt;<a href="classov__type_1_1JPLQuat.html" class="m-doc">ov_type::<wbr />JPLQuat</a>&gt; <a href="#aa7f71683c999ad0c08701277fd6dd733" class="m-doc-self">_calib_imu_GYROtoIMU</a>
            </dt>
            <dd>Rotation from gyroscope frame to the &quot;IMU&quot; accelerometer frame (kalibr model)</dd>
            <dt id="a605caf4fbbe3f4309f5f0ce118794884">
              std::shared_ptr&lt;<a href="classov__type_1_1JPLQuat.html" class="m-doc">ov_type::<wbr />JPLQuat</a>&gt; <a href="#a605caf4fbbe3f4309f5f0ce118794884" class="m-doc-self">_calib_imu_ACCtoIMU</a>
            </dt>
            <dd>Rotation from accelerometer to the &quot;IMU&quot; gyroscope frame frame (rpng model)</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="a3a8f85e6481f2418288b7692d9eaa6a0"><div>
            <h3>
              <span class="m-doc-wrap-bumper">static Eigen::Matrix3d ov_msckf::<wbr />State::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a3a8f85e6481f2418288b7692d9eaa6a0" class="m-doc-self">Dm</a>(</span><span class="m-doc-wrap"><a href="structov__msckf_1_1StateOptions.html#a4e021a0c4752fd6990fffb60f775dbb7" class="m-doc">StateOptions::<wbr />ImuModel</a> imu_model,
              const Eigen::MatrixXd&amp; vec)</span></span>
            </h3>
            <p>Gyroscope and accelerometer intrinsic matrix (scale imperfection and axis misalignment)</p>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>3x3 matrix of current imu gyroscope / accelerometer intrinsics</td>
                </tr>
              </tfoot>
            </table>
<p>If kalibr model, lower triangular of the matrix is used If rpng model, upper triangular of the matrix is used</p>
          </div></section>
          <section class="m-doc-details" id="ae8e70766eaaf8d4009a2c0f519bb645e"><div>
            <h3>
              <span class="m-doc-wrap-bumper">static Eigen::Matrix3d ov_msckf::<wbr />State::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ae8e70766eaaf8d4009a2c0f519bb645e" class="m-doc-self">Tg</a>(</span><span class="m-doc-wrap">const Eigen::MatrixXd&amp; vec)</span></span>
            </h3>
            <p>Gyroscope gravity sensitivity.</p>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>3x3 matrix of current gravity sensitivity</td>
                </tr>
              </tfoot>
            </table>
<p>For both kalibr and rpng models, this a 3x3 that is column-wise filled.</p>
          </div></section>
          <section class="m-doc-details" id="ad6098accfeb57e7eb8c8a22bfd45ec0b"><div>
            <h3>
              <span class="m-doc-wrap-bumper"> ov_msckf::<wbr />State::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ad6098accfeb57e7eb8c8a22bfd45ec0b" class="m-doc-self">State</a>(</span><span class="m-doc-wrap"><a href="structov__msckf_1_1StateOptions.html" class="m-doc">StateOptions</a>&amp; options_)</span></span>
            </h3>
            <p>Default Constructor (will initialize variables to defaults)</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">options_</td>
                  <td>Options structure containing filter options</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a36420e71ffa54625667eac2a8a345582"><div>
            <h3>
              <span class="m-doc-wrap-bumper">double ov_msckf::<wbr />State::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a36420e71ffa54625667eac2a8a345582" class="m-doc-self">margtimestep</a>(</span><span class="m-doc-wrap">)</span></span>
            </h3>
            <p>Will return the timestep that we will marginalize next. As of right now, since we are using a sliding window, this is the oldest clone. But if you wanted to do a keyframe system, you could selectively marginalize clones.</p>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>timestep of clone we will marginalize</td>
                </tr>
              </tfoot>
            </table>
          </div></section>
          <section class="m-doc-details" id="a37c45cc1d3d1a3dcc46d3799a997355f"><div>
            <h3>
              <span class="m-doc-wrap-bumper">int ov_msckf::<wbr />State::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a37c45cc1d3d1a3dcc46d3799a997355f" class="m-doc-self">max_covariance_size</a>(</span><span class="m-doc-wrap">)</span></span>
            </h3>
            <p>Calculates the current max size of the covariance.</p>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>Size of the current covariance matrix</td>
                </tr>
              </tfoot>
            </table>
          </div></section>
          <section class="m-doc-details" id="ad9274f5ef5012b4108666c7d0e461934"><div>
            <h3>
              <span class="m-doc-wrap-bumper">int ov_msckf::<wbr />State::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ad9274f5ef5012b4108666c7d0e461934" class="m-doc-self">imu_intrinsic_size</a>(</span><span class="m-doc-wrap">) const</span></span>
            </h3>
            <p>Calculates the error state size for imu intrinsics.</p>
            <table class="m-table m-fullwidth m-flat">
              <tfoot>
                <tr>
                  <th style="width: 1%">Returns</th>
                  <td>size of error state</td>
                </tr>
              </tfoot>
            </table>
<p>This is used to construct our state transition which depends on if we are estimating calibration. 15 if doing intrinsics, another +9 if doing grav sensitivity</p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
