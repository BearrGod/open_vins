<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ov_core::TrackKLT class | OpenVINS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600&amp;subset=latin-ext" />
  <link rel="stylesheet" href="m-udel+documentation.compiled.css" />
  <link rel="stylesheet" href="custom.css" />
  <link rel="icon" href="favicon-light.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2f73a3" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OpenVINS</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="namespaceov__core.html">ov_core</a></li>
            <li><a href="namespaceov__type.html">ov_type</a></li>
            <li><a href="namespaceov__msckf.html">ov_msckf</a></li>
            <li><a href="namespaceov__init.html">ov_init</a></li>
            <li><a href="namespaceov__eval.html">ov_eval</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="8">
            <li><a href="https://github.com/rpng/open_vins/">GitHub</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="namespaceov__core.html">ov_core</a>::<wbr/></span>TrackKLT <span class="m-thin">class</span>
        </h1>
        <p>KLT tracking of features.</p>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#base-classes">Base classes</a></li>
                <li><a href="#typeless-methods">Constructors, destructors, conversion operators</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
                <li><a href="#pro-methods">Protected functions</a></li>
              </ul>
            </li>
          </ul>
        </div>
<p>This is the implementation of a KLT visual frontend for tracking sparse features. We can track either monocular cameras across time (temporally) along with stereo cameras which we also track across time (temporally) but track from left to right to find the stereo correspondence information also. This uses the <a href="https://github.com/opencv/opencv/blob/master/modules/video/src/lkpyramid.cpp">calcOpticalFlowPyrLK</a> OpenCV function to do the KLT tracking.</p>
        <section id="base-classes">
          <h2><a href="#base-classes">Base classes</a></h2>
          <dl class="m-doc">
            <dt>
              class <a href="classov__core_1_1TrackBase.html" class="m-doc">TrackBase</a>
            </dt>
            <dd>Visual feature tracking base class.</dd>
          </dl>
        </section>
        <section id="typeless-methods">
          <h2><a href="#typeless-methods">Constructors, destructors, conversion operators</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper"><a href="#ac55893ba763f76c79ec7dd6daf53b1a2" class="m-doc">TrackKLT</a>(</span><span class="m-doc-wrap">std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__core_1_1CamBase.html" class="m-doc">CamBase</a>&gt;&gt; cameras,
              int numfeats,
              int numaruco,
              bool binocular,
              <a href="classov__core_1_1TrackBase.html#aa4b34a5dce99b59522d57bf9278c9a1a" class="m-doc">HistogramMethod</a> histmethod,
              int fast_threshold,
              int gridx,
              int gridy,
              int minpxdist) <span class="m-label m-flat m-info">explicit</span> </span>
            </dt>
            <dd>Public constructor with configuration variables.</dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a9c114c59f93c8db9178bee483be785bd" class="m-doc">feed_new_camera</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1CameraData.html" class="m-doc">CameraData</a>&amp; message) <span class="m-label m-flat m-warning">virtual</span></span>
            </dt>
            <dd>Process a new image.</dd>
          </dl>
        </section>
        <section id="pro-methods">
          <h2><a href="#pro-methods">Protected functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a74d790b70b686f8f4a9788ef765ab3b1" class="m-doc">feed_monocular</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1CameraData.html" class="m-doc">CameraData</a>&amp; message,
              size_t msg_id)</span>
            </dt>
            <dd>Process a new monocular image.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a7e0f2b1990992ed7dbd916732dd9d7a9" class="m-doc">feed_stereo</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1CameraData.html" class="m-doc">CameraData</a>&amp; message,
              size_t msg_id_left,
              size_t msg_id_right)</span>
            </dt>
            <dd>Process new stereo pair of images.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a8443c645bf05d2ec7e5e14ae44150bcd" class="m-doc">perform_detection_monocular</a>(</span><span class="m-doc-wrap">const std::vector&lt;cv::Mat&gt;&amp; img0pyr,
              const cv::Mat&amp; mask0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;size_t&gt;&amp; ids0)</span>
            </dt>
            <dd>Detects new features in the current image.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a5c88ad139cd0a0e6633ec604fdee5a86" class="m-doc">perform_detection_stereo</a>(</span><span class="m-doc-wrap">const std::vector&lt;cv::Mat&gt;&amp; img0pyr,
              const std::vector&lt;cv::Mat&gt;&amp; img1pyr,
              const cv::Mat&amp; mask0,
              const cv::Mat&amp; mask1,
              size_t cam_id_left,
              size_t cam_id_right,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts1,
              std::vector&lt;size_t&gt;&amp; ids0,
              std::vector&lt;size_t&gt;&amp; ids1)</span>
            </dt>
            <dd>Detects new features in the current stereo pair.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a7747a5ceca5c530350cf0c745a33bfe5" class="m-doc">perform_matching</a>(</span><span class="m-doc-wrap">const std::vector&lt;cv::Mat&gt;&amp; img0pyr,
              const std::vector&lt;cv::Mat&gt;&amp; img1pyr,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts1,
              size_t id0,
              size_t id1,
              std::vector&lt;uchar&gt;&amp; mask_out)</span>
            </dt>
            <dd>KLT track between two images, and do RANSAC afterwards.</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="ac55893ba763f76c79ec7dd6daf53b1a2"><div>
            <h3>
              <span class="m-doc-wrap-bumper"> ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ac55893ba763f76c79ec7dd6daf53b1a2" class="m-doc-self">TrackKLT</a>(</span><span class="m-doc-wrap">std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__core_1_1CamBase.html" class="m-doc">CamBase</a>&gt;&gt; cameras,
              int numfeats,
              int numaruco,
              bool binocular,
              <a href="classov__core_1_1TrackBase.html#aa4b34a5dce99b59522d57bf9278c9a1a" class="m-doc">HistogramMethod</a> histmethod,
              int fast_threshold,
              int gridx,
              int gridy,
              int minpxdist) <span class="m-label m-info">explicit</span> </span></span>
            </h3>
            <p>Public constructor with configuration variables.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">cameras</td>
                  <td>camera calibration object which has all camera intrinsics in it</td>
                </tr>
                <tr>
                  <td>numfeats</td>
                  <td>number of features we want want to track (i.e. track 200 points from frame to frame)</td>
                </tr>
                <tr>
                  <td>numaruco</td>
                  <td>the max id of the arucotags, so we ensure that we start our non-auroc features above this value</td>
                </tr>
                <tr>
                  <td>binocular</td>
                  <td>if we should do binocular feature tracking or stereo if there are multiple cameras</td>
                </tr>
                <tr>
                  <td>histmethod</td>
                  <td>what type of histogram pre-processing should be done (histogram eq?)</td>
                </tr>
                <tr>
                  <td>fast_threshold</td>
                  <td>FAST detection threshold</td>
                </tr>
                <tr>
                  <td>gridx</td>
                  <td>size of grid in the x-direction / u-direction</td>
                </tr>
                <tr>
                  <td>gridy</td>
                  <td>size of grid in the y-direction / v-direction</td>
                </tr>
                <tr>
                  <td>minpxdist</td>
                  <td>features need to be at least this number pixels away from each other</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a9c114c59f93c8db9178bee483be785bd"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a9c114c59f93c8db9178bee483be785bd" class="m-doc-self">feed_new_camera</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1CameraData.html" class="m-doc">CameraData</a>&amp; message) <span class="m-label m-warning">virtual</span></span></span>
            </h3>
            <p>Process a new image.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">message</td>
                  <td>Contains our timestamp, images, and camera ids</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a74d790b70b686f8f4a9788ef765ab3b1"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a74d790b70b686f8f4a9788ef765ab3b1" class="m-doc-self">feed_monocular</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1CameraData.html" class="m-doc">CameraData</a>&amp; message,
              size_t msg_id) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Process a new monocular image.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">message</td>
                  <td>Contains our timestamp, images, and camera ids</td>
                </tr>
                <tr>
                  <td>msg_id</td>
                  <td>the camera index in message data vector</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a7e0f2b1990992ed7dbd916732dd9d7a9"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a7e0f2b1990992ed7dbd916732dd9d7a9" class="m-doc-self">feed_stereo</a>(</span><span class="m-doc-wrap">const <a href="structov__core_1_1CameraData.html" class="m-doc">CameraData</a>&amp; message,
              size_t msg_id_left,
              size_t msg_id_right) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Process new stereo pair of images.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">message</td>
                  <td>Contains our timestamp, images, and camera ids</td>
                </tr>
                <tr>
                  <td>msg_id_left</td>
                  <td>first image index in message data vector</td>
                </tr>
                <tr>
                  <td>msg_id_right</td>
                  <td>second image index in message data vector</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a8443c645bf05d2ec7e5e14ae44150bcd"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a8443c645bf05d2ec7e5e14ae44150bcd" class="m-doc-self">perform_detection_monocular</a>(</span><span class="m-doc-wrap">const std::vector&lt;cv::Mat&gt;&amp; img0pyr,
              const cv::Mat&amp; mask0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;size_t&gt;&amp; ids0) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Detects new features in the current image.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">img0pyr</td>
                  <td>image we will detect features on (first level of pyramid)</td>
                </tr>
                <tr>
                  <td>mask0</td>
                  <td>mask which has what ROI we do not want features in</td>
                </tr>
                <tr>
                  <td>pts0</td>
                  <td>vector of currently extracted keypoints in this image</td>
                </tr>
                <tr>
                  <td>ids0</td>
                  <td>vector of feature ids for each currently extracted keypoint</td>
                </tr>
              </tbody>
            </table>
<p>Given an image and its currently extracted features, this will try to add new features if needed. Will try to always have the &quot;max_features&quot; being tracked through KLT at each timestep. Passed images should already be grayscaled.</p>
          </div></section>
          <section class="m-doc-details" id="a5c88ad139cd0a0e6633ec604fdee5a86"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a5c88ad139cd0a0e6633ec604fdee5a86" class="m-doc-self">perform_detection_stereo</a>(</span><span class="m-doc-wrap">const std::vector&lt;cv::Mat&gt;&amp; img0pyr,
              const std::vector&lt;cv::Mat&gt;&amp; img1pyr,
              const cv::Mat&amp; mask0,
              const cv::Mat&amp; mask1,
              size_t cam_id_left,
              size_t cam_id_right,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts1,
              std::vector&lt;size_t&gt;&amp; ids0,
              std::vector&lt;size_t&gt;&amp; ids1) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Detects new features in the current stereo pair.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">img0pyr</td>
                  <td>left image we will detect features on (first level of pyramid)</td>
                </tr>
                <tr>
                  <td>img1pyr</td>
                  <td>right image we will detect features on (first level of pyramid)</td>
                </tr>
                <tr>
                  <td>mask0</td>
                  <td>mask which has what ROI we do not want features in</td>
                </tr>
                <tr>
                  <td>mask1</td>
                  <td>mask which has what ROI we do not want features in</td>
                </tr>
                <tr>
                  <td>cam_id_left</td>
                  <td>first camera sensor id</td>
                </tr>
                <tr>
                  <td>cam_id_right</td>
                  <td>second camera sensor id</td>
                </tr>
                <tr>
                  <td>pts0</td>
                  <td>left vector of currently extracted keypoints</td>
                </tr>
                <tr>
                  <td>pts1</td>
                  <td>right vector of currently extracted keypoints</td>
                </tr>
                <tr>
                  <td>ids0</td>
                  <td>left vector of feature ids for each currently extracted keypoint</td>
                </tr>
                <tr>
                  <td>ids1</td>
                  <td>right vector of feature ids for each currently extracted keypoint</td>
                </tr>
              </tbody>
            </table>
<p>This does the same logic as the <a href="classov__core_1_1TrackKLT.html#a8443c645bf05d2ec7e5e14ae44150bcd" class="m-doc">perform_<wbr />detection_<wbr />monocular()</a> function, but we also enforce stereo contraints. So we detect features in the left image, and then KLT track them onto the right image. If we have valid tracks, then we have both the keypoint on the left and its matching point in the right image. Will try to always have the &quot;max_features&quot; being tracked through KLT at each timestep.</p>
          </div></section>
          <section class="m-doc-details" id="a7747a5ceca5c530350cf0c745a33bfe5"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackKLT::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a7747a5ceca5c530350cf0c745a33bfe5" class="m-doc-self">perform_matching</a>(</span><span class="m-doc-wrap">const std::vector&lt;cv::Mat&gt;&amp; img0pyr,
              const std::vector&lt;cv::Mat&gt;&amp; img1pyr,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts1,
              size_t id0,
              size_t id1,
              std::vector&lt;uchar&gt;&amp; mask_out) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>KLT track between two images, and do RANSAC afterwards.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">img0pyr</td>
                  <td>starting image pyramid</td>
                </tr>
                <tr>
                  <td>img1pyr</td>
                  <td>image pyramid we want to track too</td>
                </tr>
                <tr>
                  <td>pts0</td>
                  <td>starting points</td>
                </tr>
                <tr>
                  <td>pts1</td>
                  <td>points we have tracked</td>
                </tr>
                <tr>
                  <td>id0</td>
                  <td>id of the first camera</td>
                </tr>
                <tr>
                  <td>id1</td>
                  <td>id of the second camera</td>
                </tr>
                <tr>
                  <td>mask_out</td>
                  <td>what points had valid tracks</td>
                </tr>
              </tbody>
            </table>
<p>This will track features from the first image into the second image. The two point vectors will be of equal size, but the mask_out variable will specify which points are good or bad. If the second vector is non-empty, it will be used as an initial guess of where the keypoints are in the second image.</p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
